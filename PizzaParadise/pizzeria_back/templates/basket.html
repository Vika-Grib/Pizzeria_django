<!DOCTYPE html>
<html lang="en - ru">
<head>
    {% load static %}

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #234;
            background-size: cover;
            color: #fff;
            text-align: center;
            padding: 40px;
            width: 100%;
        }
        h1 {
            margin: 0;
            color: #ff9900;
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .cart {
            max-width: 600px;
            margin: 20px auto;
        }
        .cart-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .cart-item {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #ddd;
            background-color: #fff;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .cart-item img {
            max-width: 50px;
            max-height: 50px;
            margin-right: 10px;
        }
        .empty-cart {
            text-align: center;
            margin-top: 20px;
        }
        .total {
            margin-top: 20px;
            font-weight: bold;
            text-align: right;
        }
        .checkout-button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
    </style>
    <title>Корзина</title>
</head>
<body>
    <header>
        <h1>Корзина</h1>
    </header>
    <div class="cart">
        {% if cart %}
            <ul class="cart-list">
                {% for item in cart %}
                    <li class="cart-item">
                        <img src="{{ item.product.image }}" alt="{{ item.product.title }}">
                        <div>
                            <div>Товар ID: {{ item.product.id }}</div>
                            <div>Количество: {{ item.quantity }}</div>
                        </div>
                    </li>
                {% endfor %}
            </ul>
            <div class="total"> </div>

            <form class="order_data" action="customer/add_to_cart" method="POST" name="order_data">
                {% csrf_token %}
            </form>

        {% else %}
            <p class="empty-cart">Ваша корзина пуста</p>
        {% endif %}


    <script> var order_products = localStorage.getItem("inputValue")
    let listCard = document.querySelector('.cart-list');
    order_products = order_products.slice(1, -1)
    console.log(order_products)
    let new_order_products = order_products.split('},{');
    console.log(new_order_products)
    listCard.innerHTML = '';
    let count = 0;
    let totalPrice = 0;
    let total = document.querySelector('.total');
    let order_data = document.querySelector('.order_data');
    order_data.innerHTML = '';
    let newForm = document.createElement('div');
    newForm.innerHTML = `
            <input name="address" class="order-info" placeholder="Введите ваш адрес: ">
            <input name="mail" class="order-info" placeholder="Введите ваш mail: ">

            <input type="radio" id="card" name="payment" value="card">
            <label for="card">Оплата картой</label><br>
            <input type="radio" id="cash" name="payment" value="cash">
            <label for="cash">Оплата наличными</label><br>

            <button class="checkout-button">Оформить заказ</button>
            <input name="hidden_data" type="hidden" value='{${order_products}}' >`;
            order_data.appendChild(newForm);
    new_order_products.forEach((value, key)=>{
        new_value = '{' + value + '}';
        value = JSON.parse(new_value);
        console.log(value)
        totalPrice = parseFloat(totalPrice) + parseFloat(value.price);
        count = count + value.quantity;
        let newDiv = document.createElement('li');
        newDiv.innerHTML = `
            <div><img src=${value.img}></div>
            <div>${value.title}</div>
            <div>${value.price}0</div>
            <div>${value.size}</div>`;
            listCard.appendChild(newDiv);
    })
    total.innerText = 'К оплате: ' + totalPrice.toLocaleString() + '0';

    </script>
    </div>
</body>
</html>


